// Code generated by github.com/go-surreal/som, DO NOT EDIT.
package conv

import (
	v2 "github.com/fxamacker/cbor/v2"
	som "github.com/go-surreal/som/tests/basic/gen/som"
	cbor "github.com/go-surreal/som/tests/basic/gen/som/internal/cbor"
	types "github.com/go-surreal/som/tests/basic/gen/som/internal/types"
	model "github.com/go-surreal/som/tests/basic/model"
	models "github.com/surrealdb/surrealdb.go/pkg/models"
)

type TeamMember struct {
	model.TeamMember
}

func (c *TeamMember) MarshalCBOR() ([]byte, error) {
	if c == nil {
		return cbor.Marshal(nil)
	}
	data := make(map[string]any, 1)

	// Embedded som.Node/Edge ID field

	data["role"] = c.Role

	return cbor.Marshal(data)
}

func (c *TeamMember) UnmarshalCBOR(data []byte) error {
	var rawMap map[string]v2.RawMessage
	if err := cbor.Unmarshal(data, &rawMap); err != nil {
		return err
	}

	// Embedded som.Node/Edge ID field
	if raw, ok := rawMap["id"]; ok {
		var recordID *models.RecordID
		if err := cbor.Unmarshal(raw, &recordID); err != nil {
			return err
		}
		if recordID != nil {
			idRaw, err := cbor.Marshal(recordID.ID)
			if err != nil {
				return err
			}
			var rawObj map[string]v2.RawMessage
			if err := cbor.Unmarshal(idRaw, &rawObj); err != nil {
				return err
			}
			var key model.TeamMemberKey
			{
				var rid *models.RecordID
				if err := cbor.Unmarshal(rawObj["member"], &rid); err != nil {
					return err
				}
				if rid != nil {
					idRaw, err := cbor.Marshal(rid.ID)
					if err != nil {
						return err
					}
					var idStr string
					if err := cbor.Unmarshal(idRaw, &idStr); err != nil {
						return err
					}
					key.Member = model.AllTypes{Node: som.NewNode[som.ULID](som.ULID(idStr))}
				}
			}
			{
				var rid *models.RecordID
				if err := cbor.Unmarshal(rawObj["forecast"], &rid); err != nil {
					return err
				}
				if rid != nil {
					idRaw, err := cbor.Marshal(rid.ID)
					if err != nil {
						return err
					}
					var rawArr []v2.RawMessage
					if err := cbor.Unmarshal(idRaw, &rawArr); err != nil {
						return err
					}
					if len(rawArr) >= 2 {
						var innerKey model.WeatherKey
						if err := cbor.Unmarshal(rawArr[0], &innerKey.City); err != nil {
							return err
						}
						{
							var DateErr error
							innerKey.Date, DateErr = cbor.UnmarshalDateTime(rawArr[1])
							if DateErr != nil {
								return DateErr
							}
						}
						key.Forecast = model.Weather{Node: som.NewNode[model.WeatherKey](innerKey)}
					}
				}
			}
			c.Node = som.NewNode[model.TeamMemberKey](key)
		}
	}

	if raw, ok := rawMap["role"]; ok {
		cbor.Unmarshal(raw, &c.Role)
	}

	return nil
}

func FromTeamMember(data model.TeamMember) TeamMember {
	return TeamMember{TeamMember: data}
}
func FromTeamMemberPtr(data *model.TeamMember) *TeamMember {
	if data == nil {
		return nil
	}
	return &TeamMember{TeamMember: *data}
}

func ToTeamMember(data TeamMember) model.TeamMember {
	return data.TeamMember
}
func ToTeamMemberPtr(data *TeamMember) *model.TeamMember {
	if data == nil {
		return nil
	}
	result := data.TeamMember
	return &result
}

type teamMemberLink struct {
	TeamMember
	ID *models.RecordID
}

func (f *teamMemberLink) MarshalCBOR() ([]byte, error) {
	if f == nil {
		return nil, nil
	}
	return cbor.Marshal(f.ID)
}

func (f *teamMemberLink) UnmarshalCBOR(data []byte) error {
	if err := cbor.Unmarshal(data, &f.ID); err == nil {
		return nil
	}
	type alias teamMemberLink
	var link alias
	err := cbor.Unmarshal(data, &link)
	if err == nil {
		*f = teamMemberLink(link)
	}
	return err
}

func fromTeamMemberLink(link *teamMemberLink) model.TeamMember {
	if link == nil {
		return model.TeamMember{}
	}
	res := TeamMember(link.TeamMember)
	return ToTeamMember(res)
}

func fromTeamMemberLinkPtr(link *teamMemberLink) *model.TeamMember {
	if link == nil {
		return nil
	}
	res := TeamMember(link.TeamMember)
	out := ToTeamMember(res)
	return &out
}

func toTeamMemberLink(node model.TeamMember) *teamMemberLink {
	if node.ID().Member.ID() == "" {
		return nil
	}
	var zeroForecastKey model.WeatherKey
	if node.ID().Forecast.ID() == zeroForecastKey {
		return nil
	}
	rid := models.NewRecordID("team_member", map[string]any{
		"forecast": models.NewRecordID("weather", []any{node.ID().Forecast.ID().City, &types.DateTime{Time: node.ID().Forecast.ID().Date}}),
		"member":   models.NewRecordID("all_types", string(node.ID().Member.ID())),
	})
	link := teamMemberLink{TeamMember: FromTeamMember(node), ID: &rid}
	return &link
}

func toTeamMemberLinkPtr(node *model.TeamMember) *teamMemberLink {
	if node == nil {
		return nil
	}
	if node.ID().Member.ID() == "" {
		return nil
	}
	var zeroForecastKey model.WeatherKey
	if node.ID().Forecast.ID() == zeroForecastKey {
		return nil
	}
	rid := models.NewRecordID("team_member", map[string]any{
		"forecast": models.NewRecordID("weather", []any{node.ID().Forecast.ID().City, &types.DateTime{Time: node.ID().Forecast.ID().Date}}),
		"member":   models.NewRecordID("all_types", string(node.ID().Member.ID())),
	})
	link := teamMemberLink{TeamMember: FromTeamMember(*node), ID: &rid}
	return &link
}
