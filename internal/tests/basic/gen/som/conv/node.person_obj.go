// Code generated by github.com/go-surreal/som, DO NOT EDIT.
package conv

import (
	v2 "github.com/fxamacker/cbor/v2"
	som "github.com/go-surreal/som/tests/basic/gen/som"
	cbor "github.com/go-surreal/som/tests/basic/gen/som/internal/cbor"
	model "github.com/go-surreal/som/tests/basic/model"
	models "github.com/surrealdb/surrealdb.go/pkg/models"
)

type PersonObj struct {
	model.PersonObj
}

func (c *PersonObj) MarshalCBOR() ([]byte, error) {
	if c == nil {
		return cbor.Marshal(nil)
	}
	data := make(map[string]any, 1)

	// Embedded som.Node/Edge ID field

	data["email"] = c.Email

	return cbor.Marshal(data)
}

func (c *PersonObj) UnmarshalCBOR(data []byte) error {
	var rawMap map[string]v2.RawMessage
	if err := cbor.Unmarshal(data, &rawMap); err != nil {
		return err
	}

	// Embedded som.Node/Edge ID field
	if raw, ok := rawMap["id"]; ok {
		var recordID *som.ID
		if err := cbor.Unmarshal(raw, &recordID); err != nil {
			return err
		}
		if recordID != nil {
			idRaw, err := cbor.Marshal(recordID.ID)
			if err == nil {
				var rawObj map[string]v2.RawMessage
				if err := cbor.Unmarshal(idRaw, &rawObj); err == nil {
					var key model.PersonKey
					cbor.Unmarshal(rawObj["name"], &key.Name)
					cbor.Unmarshal(rawObj["age"], &key.Age)
					c.CustomNode = som.NewCustomNode[model.PersonKey](key)
				}
			}
		}
	}

	if raw, ok := rawMap["email"]; ok {
		cbor.Unmarshal(raw, &c.Email)
	}

	return nil
}

func FromPersonObj(data model.PersonObj) PersonObj {
	return PersonObj{PersonObj: data}
}
func FromPersonObjPtr(data *model.PersonObj) *PersonObj {
	if data == nil {
		return nil
	}
	return &PersonObj{PersonObj: *data}
}

func ToPersonObj(data PersonObj) model.PersonObj {
	return data.PersonObj
}
func ToPersonObjPtr(data *PersonObj) *model.PersonObj {
	if data == nil {
		return nil
	}
	result := data.PersonObj
	return &result
}

type personObjLink struct {
	PersonObj
	ID *som.ID
}

func (f *personObjLink) MarshalCBOR() ([]byte, error) {
	if f == nil {
		return nil, nil
	}
	return cbor.Marshal(f.ID)
}

func (f *personObjLink) UnmarshalCBOR(data []byte) error {
	if err := cbor.Unmarshal(data, &f.ID); err == nil {
		return nil
	}
	type alias personObjLink
	var link alias
	err := cbor.Unmarshal(data, &link)
	if err == nil {
		*f = personObjLink(link)
	}
	return err
}

func fromPersonObjLink(link *personObjLink) model.PersonObj {
	if link == nil {
		return model.PersonObj{}
	}
	res := PersonObj(link.PersonObj)
	return ToPersonObj(res)
}

func fromPersonObjLinkPtr(link *personObjLink) *model.PersonObj {
	if link == nil {
		return nil
	}
	res := PersonObj(link.PersonObj)
	out := ToPersonObj(res)
	return &out
}

func toPersonObjLink(node model.PersonObj) *personObjLink {
	var zeroKey model.PersonKey
	if node.ID() == zeroKey {
		return nil
	}
	rid := models.NewRecordID("person_obj", map[string]any{
		"age":  node.ID().Age,
		"name": node.ID().Name,
	})
	link := personObjLink{PersonObj: FromPersonObj(node), ID: &rid}
	return &link
}

func toPersonObjLinkPtr(node *model.PersonObj) *personObjLink {
	if node == nil {
		return nil
	}
	var zeroKey model.PersonKey
	if node.ID() == zeroKey {
		return nil
	}
	rid := models.NewRecordID("person_obj", map[string]any{
		"age":  node.ID().Age,
		"name": node.ID().Name,
	})
	link := personObjLink{PersonObj: FromPersonObj(*node), ID: &rid}
	return &link
}
