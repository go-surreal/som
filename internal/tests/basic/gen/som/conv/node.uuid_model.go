// Code generated by github.com/go-surreal/som, DO NOT EDIT.
package conv

import (
	"fmt"
	v2 "github.com/fxamacker/cbor/v2"
	som "github.com/go-surreal/som/tests/basic/gen/som"
	cbor "github.com/go-surreal/som/tests/basic/gen/som/internal/cbor"
	model "github.com/go-surreal/som/tests/basic/model"
	models "github.com/surrealdb/surrealdb.go/pkg/models"
)

type UUIDModel struct {
	model.UUIDModel
}

func (c *UUIDModel) MarshalCBOR() ([]byte, error) {
	if c == nil {
		return cbor.Marshal(nil)
	}
	data := make(map[string]any, 2)

	// Embedded som.Node/Edge ID field
	if c.ID() != "" {
		data["id"] = models.NewRecordID("uuid_model", c.ID())
	}

	data["label"] = c.Label

	return cbor.Marshal(data)
}

func (c *UUIDModel) UnmarshalCBOR(data []byte) error {
	var rawMap map[string]v2.RawMessage
	if err := cbor.Unmarshal(data, &rawMap); err != nil {
		return err
	}

	// Embedded som.Node/Edge ID field
	if raw, ok := rawMap["id"]; ok {
		var recordID *som.ID
		if err := cbor.Unmarshal(raw, &recordID); err != nil {
			return err
		}
		var idStr string
		if recordID != nil {
			s, ok := recordID.ID.(string)
			if !ok {
				return fmt.Errorf("expected string ID, got %T", recordID.ID)
			}
			idStr = s
		}
		c.CustomNode = som.NewCustomNode[som.UUID](idStr)
	}

	if raw, ok := rawMap["label"]; ok {
		cbor.Unmarshal(raw, &c.Label)
	}

	return nil
}

func FromUUIDModel(data model.UUIDModel) UUIDModel {
	return UUIDModel{UUIDModel: data}
}
func FromUUIDModelPtr(data *model.UUIDModel) *UUIDModel {
	if data == nil {
		return nil
	}
	return &UUIDModel{UUIDModel: *data}
}

func ToUUIDModel(data UUIDModel) model.UUIDModel {
	return data.UUIDModel
}
func ToUUIDModelPtr(data *UUIDModel) *model.UUIDModel {
	if data == nil {
		return nil
	}
	result := data.UUIDModel
	return &result
}

type uuidmodelLink struct {
	UUIDModel
	ID *som.ID
}

func (f *uuidmodelLink) MarshalCBOR() ([]byte, error) {
	if f == nil {
		return nil, nil
	}
	return cbor.Marshal(f.ID)
}

func (f *uuidmodelLink) UnmarshalCBOR(data []byte) error {
	if err := cbor.Unmarshal(data, &f.ID); err == nil {
		return nil
	}
	type alias uuidmodelLink
	var link alias
	err := cbor.Unmarshal(data, &link)
	if err == nil {
		*f = uuidmodelLink(link)
	}
	return err
}

func fromUUIDModelLink(link *uuidmodelLink) model.UUIDModel {
	if link == nil {
		return model.UUIDModel{}
	}
	res := UUIDModel(link.UUIDModel)
	return ToUUIDModel(res)
}

func fromUUIDModelLinkPtr(link *uuidmodelLink) *model.UUIDModel {
	if link == nil {
		return nil
	}
	res := UUIDModel(link.UUIDModel)
	out := ToUUIDModel(res)
	return &out
}

func toUUIDModelLink(node model.UUIDModel) *uuidmodelLink {
	if node.ID() == "" {
		return nil
	}
	rid := models.NewRecordID("uuid_model", node.ID())
	link := uuidmodelLink{UUIDModel: FromUUIDModel(node), ID: &rid}
	return &link
}

func toUUIDModelLinkPtr(node *model.UUIDModel) *uuidmodelLink {
	if node == nil || node.ID() == "" {
		return nil
	}
	rid := models.NewRecordID("uuid_model", node.ID())
	link := uuidmodelLink{UUIDModel: FromUUIDModel(*node), ID: &rid}
	return &link
}
