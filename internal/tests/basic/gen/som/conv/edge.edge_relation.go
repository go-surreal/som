// Code generated by github.com/go-surreal/som, DO NOT EDIT.
package conv

import (
	"fmt"
	v2 "github.com/fxamacker/cbor/v2"
	som "github.com/go-surreal/som/tests/basic/gen/som"
	internal "github.com/go-surreal/som/tests/basic/gen/som/internal"
	cbor "github.com/go-surreal/som/tests/basic/gen/som/internal/cbor"
	types "github.com/go-surreal/som/tests/basic/gen/som/internal/types"
	model "github.com/go-surreal/som/tests/basic/model"
	models "github.com/surrealdb/surrealdb.go/pkg/models"
)

type EdgeRelation struct {
	model.EdgeRelation
}

func (c *EdgeRelation) MarshalCBOR() ([]byte, error) {
	if c == nil {
		return cbor.Marshal(nil)
	}
	data := make(map[string]any, 4)

	// Embedded som.Node/Edge ID field
	if c.ID() != "" {
		data["id"] = models.NewRecordID("edge_relation", c.ID())
	}

	if !c.CreatedAt().IsZero() {
		data["created_at"] = &types.DateTime{Time: c.CreatedAt()}
	}
	if !c.UpdatedAt().IsZero() {
		data["updated_at"] = &types.DateTime{Time: c.UpdatedAt()}
	}
	data["meta"] = fromEdgeMeta(c.Meta)

	return cbor.Marshal(data)
}

func (c *EdgeRelation) UnmarshalCBOR(data []byte) error {
	var rawMap map[string]v2.RawMessage
	if err := cbor.Unmarshal(data, &rawMap); err != nil {
		return err
	}

	// Embedded som.Node/Edge ID field
	if raw, ok := rawMap["id"]; ok {
		var recordID *som.ID
		if err := cbor.Unmarshal(raw, &recordID); err != nil {
			return err
		}
		var idStr string
		if recordID != nil {
			s, ok := recordID.ID.(string)
			if !ok {
				return fmt.Errorf("expected string ID, got %T", recordID.ID)
			}
			idStr = s
		}
		c.Edge = som.NewEdge(idStr)
	}

	if raw, ok := rawMap["created_at"]; ok {
		tm, _ := cbor.UnmarshalDateTime(raw)
		internal.SetCreatedAt(&c.Timestamps, tm)
	}
	if raw, ok := rawMap["updated_at"]; ok {
		tm, _ := cbor.UnmarshalDateTime(raw)
		internal.SetUpdatedAt(&c.Timestamps, tm)
	}
	if raw, ok := rawMap["meta"]; ok {
		var convVal edgeMeta
		cbor.Unmarshal(raw, &convVal)
		c.Meta = toEdgeMeta(convVal)
	}

	return nil
}

func FromEdgeRelation(data model.EdgeRelation) EdgeRelation {
	return EdgeRelation{EdgeRelation: data}
}
func FromEdgeRelationPtr(data *model.EdgeRelation) *EdgeRelation {
	if data == nil {
		return nil
	}
	return &EdgeRelation{EdgeRelation: *data}
}

func ToEdgeRelation(data *EdgeRelation) model.EdgeRelation {
	return data.EdgeRelation
}
func ToEdgeRelationPtr(data *EdgeRelation) *model.EdgeRelation {
	if data == nil {
		return nil
	}
	result := data.EdgeRelation
	return &result
}
