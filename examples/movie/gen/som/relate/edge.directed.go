// Code generated by github.com/marcbinz/som, DO NOT EDIT.
package relate

import (
	"errors"
	"fmt"
	conv "github.com/marcbinz/som/examples/movie/gen/som/conv"
	model "github.com/marcbinz/som/examples/movie/model"
	marshal "github.com/surrealdb/surrealdb.go/pkg/marshal"
)

type directed struct {
	db Database
}

func (e directed) Create(edge *model.Directed) error {
	if edge == nil {
		return errors.New("the given edge must not be nil")
	}
	if edge.ID() != "" {
		return errors.New("ID must not be set for an edge to be created")
	}
	if edge.Person.ID() == "" {
		return errors.New("ID of the incoming node 'Person' must not be empty")
	}
	if edge.Movie.ID() == "" {
		return errors.New("ID of the outgoing node 'Movie' must not be empty")
	}
	query := "RELATE " + "person:" + edge.Person.ID() + "->directed->" + "movie:" + edge.Movie.ID() + " CONTENT $data"
	data := conv.FromDirected(*edge)
	convEdge, err := marshal.SmartUnmarshal[conv.Directed](e.db.Query(query, map[string]any{"data": data}))
	if err != nil {
		return fmt.Errorf("could not create relation: %w", err)
	}
	*edge = conv.ToDirected(convEdge[0])
	return nil
}

func (directed) Update(edge *model.Directed) error {
	return errors.New("not yet implemented")
}

func (directed) Delete(edge *model.Directed) error {
	return errors.New("not yet implemented")
}
